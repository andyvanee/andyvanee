box: wercker/ubuntu12.04-ruby2.0.0
build:
    steps:
        # Execute the bundle install step, a step provided by wercker
        - bundle-install
        # Execute a custom script step.
        - script:
            name: middleman build
            code: bundle exec middleman build --verbose
deploy:
    steps:
        # Execute the s3sync deploy step, a step provided by wercker
        # Cache-Control is set to one week
        - s3sync:
            key_id: $AWS_ACCESS_KEY
            key_secret: $AWS_SECRET_KEY
            bucket_url: $AWS_BUCKET_URL
            source_dir: build/
            opts: --acl-public --add-header=Cache-Control:max-age=432000
        - script:
            name: Manual modification of S3 options
            cwd: build/
            code: |
                ls
                s3cmd put --acl-public --add-header=Cache-Control:max-age=86400 --verbose index.html s3://andyvanee.com/
